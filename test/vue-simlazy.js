!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.LazyLoad=t()}(this,function(){"use strict";var e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},t=function(e,t,i){this.el=e,this.binding=t,this.vnode=i,this.imagebox=null,this.$vm=i.context,this.$lazyload=i.context.$lazyload};t.prototype.init=function(){if("string"===!e(this.binding.value))throw new Error("您的图片源不是String类型，请重试");this.imagebox=this.vnode.context.imagebox,this.imagebox.add(this.el,this.binding.value),this.listenProcess()},t.prototype.startListen=function(){var e=this.listenProcess;document.addEventListener("scroll",e.bind(this),!1)},t.prototype.removeListen=function(){var e=this.listenProcess;document.removeEventListener("scroll",e.bind(this),!1)},t.prototype.listenProcess=function(){var e=this;0!=this.imagebox.item.length&&this.imagebox.item.forEach(function(t){if(function(e,t){var i=e.ele;e.src;return i.getBoundingClientRect().top+10<(document.documentElement.clientHeight||document.body.clientHeight)}(t)){var i=new Image;i.src=t.src,e._imageStyle(t),e.imagebox.addPending(t.ele,t.src),i.onload=function(){i.complete&&e.imageOnload(t)},i.onerror=function(){e.imageOnerror(t)}}})},t.prototype.update=function(e,t){this.imagebox.update(e,t),this.listenProcess()},t.prototype.imageOnload=function(e){this._removeImageStyle(e.ele),this.imagebox.addAlready(e.ele,e.src),this._imageSet(e.ele,e.src)},t.prototype.imageOnerror=function(e){this._removeImageStyle(e.ele),this.imagebox.addFailed(e.ele,e.src),this._imageSet(e.ele,this.$lazyload.options.errorUrl)},t.prototype._imageStyle=function(e){e.ele.style.background="url("+this.$lazyload.options.loadUrl+") no-repeat center"},t.prototype._removeImageStyle=function(e){e.style.background=""},t.prototype._imageSet=function(e,t){e.src=t};var i=null,n={inserted:function(e,n,o,r){var s=new t(e,n,o);i=s,s.init(),s.startListen()},update:function(e,t,n,o){t.name;var r=t.value,s=t.oldValue;t.expression;r!==s&&i.update(e,r)},unbind:function(){i.removeListen()}},o=function(){this.eleAll=[],this.item=[],this.itemAlready=[],this.itemPending=[],this.itemFailed=[]};o.prototype.add=function(e,t){-1===this.itemAlready.findIndex(function(t){return t.ele===e})&&this.item.push({ele:e,src:t})},o.prototype.update=function(e,t){var i=this.itemAlready.findIndex(function(t){return t.ele===e});if(-1!=i)return this.itemAlready.splice(i,1),void this.add(e,t);var n=this.itemFailed.findIndex(function(t){return t.ele===e});return-1!=n?(this.itemFailed.splice(n,1),void this.add(e,t)):void 0},o.prototype.addFailed=function(e,t){this._addFailed(e,t),this._removeFromPending(e)},o.prototype.addPending=function(e,t){this._addPending(e,t),this._remove(e)},o.prototype.addAlready=function(e,t){this._addAlready(e,t),this._removeFromPending(e)},o.prototype._addAlready=function(e,t){-1===this.itemAlready.findIndex(function(t){return t.ele===e})&&this.itemAlready.push({ele:e,src:t})},o.prototype._addPending=function(e,t){-1===this.itemPending.findIndex(function(t){return t.ele===e})&&this.itemPending.push({ele:e,src:t})},o.prototype._addFailed=function(e,t){-1===this.itemFailed.findIndex(function(t){return t.ele===e})&&this.itemFailed.push({ele:e,src:t})},o.prototype._remove=function(e){var t=this.item.findIndex(function(t){return t.ele===e});-1!=t&&this.item.splice(t,1)},o.prototype._removeFromPending=function(e){var t=this.itemPending.findIndex(function(t){return t.ele===e});-1!=t&&this.itemPending.splice(t,1)};var r={data:function(){return{imagebox:new o}}},s=function(){this.options={loadUrl:"./loading-spin.svg",errorUrl:"./404.svg"}};s.prototype.register=function(e){Object.assign(this.options,e)};return{install:function(e,t){void 0===t&&(t={});var i=new s;i.register(t),e.prototype.$lazyload=i,e.mixin(r),e.directive("simple-lazy",n)}}});
