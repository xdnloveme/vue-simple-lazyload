"use strict";var isSeen=function(e,t){var i=e.ele;e.src;return i.getBoundingClientRect().top+10<(document.documentElement.clientHeight||document.body.clientHeight)},EventListener=function(e,t,i){this.el=e,this.binding=t,this.vnode=i,this.imagebox=null,this.$vm=i.context,this.$lazyload=i.context.$lazyload};EventListener.prototype.init=function(){this.imagebox=this.vnode.context.imagebox,this.imagebox.add(this.el,this.binding.value),this.listenProcess()},EventListener.prototype.startListen=function(){var e=this.listenProcess;window.addEventListener("scroll",e.bind(this),!1)},EventListener.prototype.removeListen=function(){var e=this.listenProcess;window.removeEventListener("scroll",e.bind(this),!1)},EventListener.prototype.listenProcess=function(){var e=this;0!=this.imagebox.item.length&&this.imagebox.item.forEach(function(t){if(isSeen(t)){var i=new Image;i.src=t.src,e._imageStyle(t),e.imagebox.addPending(t.ele,t.src),i.onload=function(){i.complete&&e.imageOnload(t)},i.onerror=function(){e.imageOnerror(t)}}})},EventListener.prototype.update=function(e,t){this.imagebox.update(e,t),this.listenProcess()},EventListener.prototype.imageOnload=function(e){this._removeImageStyle(e.ele),this.imagebox.addAlready(e.ele,e.src),this._imageSet(e.ele,e.src)},EventListener.prototype.imageOnerror=function(e){this._removeImageStyle(e.ele),this.imagebox.addFailed(e.ele,e.src),this._imageSet(e.ele,this.$lazyload.options.errorUrl)},EventListener.prototype._imageStyle=function(e){e.ele.style.background="url("+this.$lazyload.options.loadUrl+") no-repeat center"},EventListener.prototype._removeImageStyle=function(e){e.style.background=""},EventListener.prototype._imageSet=function(e,t){e.src=t};var listener=null,directive={inserted:function(e,t,i,n){var o=new EventListener(e,t,i);listener=o,o.init(),o.startListen()},update:function(e,t,i,n){t.name;var o=t.value,r=t.oldValue;t.expression;o!==r&&listener.update(e,o)},unbind:function(){listener.removeListen()}},ImageBox=function(){this.eleAll=[],this.item=[],this.itemAlready=[],this.itemPending=[],this.itemFailed=[]};ImageBox.prototype.add=function(e,t){-1===this.itemAlready.findIndex(function(t){return t.ele===e})&&this.item.push({ele:e,src:t})},ImageBox.prototype.update=function(e,t){var i=this.itemAlready.findIndex(function(t){return t.ele===e});if(-1!=i)return this.itemAlready.splice(i,1),void this.add(e,t);var n=this.itemFailed.findIndex(function(t){return t.ele===e});return-1!=n?(this.itemFailed.splice(n,1),void this.add(e,t)):void 0},ImageBox.prototype.addFailed=function(e,t){this._addFailed(e,t),this._removeFromPending(e)},ImageBox.prototype.addPending=function(e,t){this._addPending(e,t),this._remove(e)},ImageBox.prototype.addAlready=function(e,t){this._addAlready(e,t),this._removeFromPending(e)},ImageBox.prototype._addAlready=function(e,t){-1===this.itemAlready.findIndex(function(t){return t.ele===e})&&this.itemAlready.push({ele:e,src:t})},ImageBox.prototype._addPending=function(e,t){-1===this.itemPending.findIndex(function(t){return t.ele===e})&&this.itemPending.push({ele:e,src:t})},ImageBox.prototype._addFailed=function(e,t){-1===this.itemFailed.findIndex(function(t){return t.ele===e})&&this.itemFailed.push({ele:e,src:t})},ImageBox.prototype._remove=function(e){var t=this.item.findIndex(function(t){return t.ele===e});-1!=t&&this.item.splice(t,1)},ImageBox.prototype._removeFromPending=function(e){var t=this.itemPending.findIndex(function(t){return t.ele===e});-1!=t&&this.itemPending.splice(t,1)};var mixin={data:function(){return{imagebox:new ImageBox}}},DEFAULT_ERROR_URL="./404.svg",DEFAULT_LOAD_URL="./loading-spin.svg",LazyLoad=function(){this.options={loadUrl:DEFAULT_LOAD_URL,errorUrl:DEFAULT_ERROR_URL}};LazyLoad.prototype.register=function(e){Object.assign(this.options,e)};var install=function(e,t){void 0===t&&(t={});var i=new LazyLoad;i.register(t),e.prototype.$lazyload=i,e.mixin(mixin),e.directive("simple-lazy",directive)},index={install:install};module.exports=index;
